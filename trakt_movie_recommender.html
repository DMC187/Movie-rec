<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trakt Movie Recommender</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #recommendations { margin-top: 20px; }
        #login { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Trakt Movie Recommender</h1>
    
    <!-- Log in with Trakt Button -->
    <div id="login">
        <button onclick="authenticate()">Log in with Trakt</button>
    </div>
    
    <div id="recommendations"></div>

    <script>
        // Replace with your actual Trakt API client credentials
        const CLIENT_ID = "your_trakt_client_id"; 
        const CLIENT_SECRET = "your_trakt_client_secret"; 
        const REDIRECT_URI = "https://yourwebsite.com/callback"; // This must match your Trakt app settings

        // Check if the user is already authenticated by checking localStorage
        const accessToken = localStorage.getItem('trakt_access_token');

        if (accessToken) {
            // If the user is authenticated, start fetching recommendations
            fetchRatings(accessToken);
        } else {
            // If the user is not authenticated, show the login button
            document.getElementById("login").style.display = "block";
        }

        // Function to authenticate and get the access token
        function authenticate() {
            // Step 1: Redirect user to the Trakt authorization URL
            const authorizationUrl = `https://trakt.tv/oauth/authorize?response_type=code&client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}`;
            window.location.href = authorizationUrl; // This will open the Trakt OAuth login page in a new tab or redirect.
        }

        // Function to get the access token
        async function getAccessToken(code) {
            const tokenUrl = "https://api.trakt.tv/oauth/token";
            const data = {
                code: code,
                client_id: CLIENT_ID,
                client_secret: CLIENT_SECRET,
                redirect_uri: REDIRECT_URI,
                grant_type: "authorization_code"
            };

            const response = await fetch(tokenUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams(data)
            });

            const result = await response.json();

            // Check if token is successfully returned
            if (result.access_token) {
                localStorage.setItem('trakt_access_token', result.access_token);
                return result.access_token;
            } else {
                console.error("Failed to get access token:", result);
                alert("Error in authentication. Please try again.");
            }
        }

        // Function to fetch movie ratings and recommendations
        async function fetchRatings(accessToken) {
            const url = "https://api.trakt.tv/sync/ratings/movies";
            const response = await fetch